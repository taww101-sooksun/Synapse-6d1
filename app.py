import streamlit as st
import random

# --- 1. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏µ (High Contrast Theme) ---
st.set_page_config(page_title="SYNAPSE - ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏¥‡πà‡∏á‡πÜ ‡πÑ‡∏°‡πà‡πÄ‡∏à‡πá‡∏ö‡∏ï‡∏±‡∏ß", layout="centered")

st.markdown("""
    <style>
    /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏°‡∏à‡∏±‡∏î */
    .stApp { background-color: #000033; color: white; }
    
    /* ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏° Crimson */
    .stButton>button { 
        background-color: #990000; color: white; border-radius: 5px; 
        border: 2px solid white; width: 100%; font-weight: bold;
    }
    
    /* ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏Ç‡πâ‡∏° */
    .stTextArea>div>div>textarea, .stTextInput>div>div>input {
        background-color: #003300; color: white; border: 2px solid #FFFFFF;
    }
    
    /* ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞ Tab */
    h1, h2, h3, p { color: white !important; }
    .stTabs [data-baseweb="tab-list"] { background-color: #000033; }
    .stTabs [data-baseweb="tab"] { color: white; }
    </style>
    """, unsafe_allow_html=True)

# --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏°‡∏≠‡∏á‡∏Å‡∏• (‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ API) ---

# ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏û‡∏•‡∏á
def generate_lyrics(text, genre):
    chords_map = {
        "Pop": ["[C]", "[G]", "[Am]", "[F]"],
        "Rock": ["[E5]", "[G5]", "[A5]", "[B5]"],
        "R&B": ["[Cmaj7]", "[Am7]", "[Dm7]", "[G7]"],
        "Rap": ["[Am]", "[Am]", "[F]", "[G]"],
        "‡∏•‡∏π‡∏Å‡∏ó‡∏∏‡πà‡∏á": ["[C]", "[Am]", "[Dm]", "[G]"],
        "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï": ["[G]", "[Em]", "[C]", "[D]"],
        "‡∏´‡∏°‡∏≠‡∏•‡∏≥": ["[Am]", "[Em]", "[G]", "[Am]"]
    }
    selected_chords = chords_map.get(genre, ["[C]", "[G]"])
    lines = [l for l in text.split('\n') if l.strip()]
    
    result = f"üéµ ‡∏ö‡∏ó‡πÄ‡∏û‡∏•‡∏á‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡πÅ‡∏ô‡∏ß: {genre} (Key: {selected_chords[0]})\n"
    result += "--------------------------------------\n"
    for i, line in enumerate(lines):
        chord = selected_chords[i % len(selected_chords)]
        result += f"{chord}\n{line}\n"
    result += "--------------------------------------\n"
    result += "‡πÇ‡∏î‡∏¢ AI: ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏¥‡πà‡∏á‡πÜ ‡πÑ‡∏°‡πà‡πÄ‡∏à‡πá‡∏ö‡∏ï‡∏±‡∏ß"
    return result

# ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ä‡∏ó‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πå
def chat_bot(msg):
    responses = {
        "‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢": "‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏π‡πâ‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ",
        "‡∏ó‡πâ‡∏≠": "‡∏Å‡∏≤‡∏£‡∏Å‡πâ‡∏≤‡∏ß‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Å‡πâ‡∏≤‡∏ß ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÉ‡∏´‡πâ‡πÑ‡∏Å‡∏•‡∏Ç‡∏∂‡πâ‡∏ô ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏¥‡∏î‡∏Ñ‡∏£‡∏±‡∏ö",
        "‡πÄ‡∏´‡∏á‡∏≤": "‡∏ú‡∏° (‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏¥‡πà‡∏á‡πÜ ‡πÑ‡∏°‡πà‡πÄ‡∏à‡πá‡∏ö‡∏ï‡∏±‡∏ß) ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏™‡∏°‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö",
        "‡∏£‡∏±‡∏Å": "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏û‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏ç‡πà ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏£‡∏±‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ô‡∏∞",
        "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ": "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏Ç‡πå‡∏Å‡∏±‡∏ö‡∏ú‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏¢‡∏ô‡∏∞"
    }
    for k in responses:
        if k in msg: return responses[k]
    return random.choice(["‡∏ú‡∏°‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏∞...", "‡πÄ‡∏•‡πà‡∏≤‡∏ï‡πà‡∏≠‡∏™‡∏¥‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ú‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏™‡∏°‡∏≠", "‡∏≠‡∏∑‡πâ‡∏°‡∏° ‡∏ú‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏£‡∏±‡∏ö"])

# --- 3. ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÅ‡∏≠‡∏õ (UI) ---

st.title("üß† SYNAPSE")
st.subheader("‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏¥‡πà‡∏á‡πÜ ‡πÑ‡∏°‡πà‡πÄ‡∏à‡πá‡∏ö‡∏ï‡∏±‡∏ß")

# ‡πÄ‡∏û‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤)
try:
    st.sidebar.image("logo.jpg", use_column_width=True)
    st.sidebar.markdown("### üéß Music Therapy (Loop)")
    st.sidebar.audio("music.mp3")
    st.sidebar.info("‡πÄ‡∏û‡∏•‡∏á‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏ô‡πÑ‡∏õ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏à‡∏¥‡∏ï‡πÉ‡∏à‡∏Ñ‡∏∏‡∏ì")
except:
    st.sidebar.warning("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î logo.jpg ‡πÅ‡∏•‡∏∞ music.mp3")

tab1, tab2, tab3, tab4 = st.tabs(["1. ‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡πÉ‡∏à", "2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ô‡∏ß", "3. ‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏á", "4. ‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πå"])

with tab1:
    st.markdown("### ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡πÉ‡∏à")
    user_input = st.text_area("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏à‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏°‡∏≤‡∏ö‡πâ‡∏≤‡∏á? ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏°‡∏±‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...", height=250)
    st.session_state['input_text'] = user_input

with tab2:
    st.markdown("### ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡πà‡∏ß‡∏á‡∏ó‡∏≥‡∏ô‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì")
    genre = st.selectbox("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ô‡∏ß‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏á:", 
                        ["Pop", "Rock", "R&B", "Rap", "‡∏•‡∏π‡∏Å‡∏ó‡∏∏‡πà‡∏á", "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï", "‡∏´‡∏°‡∏≠‡∏•‡∏≥"])
    st.session_state['genre'] = genre

with tab3:
    st.markdown("### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ö‡∏ó‡πÄ‡∏û‡∏•‡∏á‡∏ö‡∏≥‡∏ö‡∏±‡∏î")
    if st.button("‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ô‡∏µ‡πâ"):
        if st.session_state.get('input_text'):
            final_lyrics = generate_lyrics(st.session_state['input_text'], st.session_state['genre'])
            st.code(final_lyrics, language='text')
            st.warning("üîí ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏∞‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏î‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡πÉ‡∏à‡πÄ‡∏û‡∏à")
            st.button("üîó ‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏õ‡∏ó‡∏µ‡πà Facebook ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ")
        else:
            st.error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡πÉ‡∏à‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö")

with tab4:
    st.markdown("### ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö '‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏¥‡πà‡∏á‡πÜ ‡πÑ‡∏°‡πà‡πÄ‡∏à‡πá‡∏ö‡∏ï‡∏±‡∏ß'")
    if "messages" not in st.session_state: st.session_state.messages = []
    
    for m in st.session_state.messages:
        with st.chat_message(m["role"]): st.markdown(m["content"])
        
    if p := st.chat_input("‡∏Ñ‡∏∏‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á..."):
        st.session_state.messages.append({"role": "user", "content": p})
        with st.chat_message("user"): st.markdown(p)
        
        ans = chat_bot(p)
        st.session_state.messages.append({"role": "assistant", "content": ans})
        with st.chat_message("assistant"): st.markdown(ans)
