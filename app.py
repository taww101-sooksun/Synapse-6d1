import streamlit as st
import time
import firebase_admin
from firebase_admin import credentials, firestore, storage
import uuid # เธชเธณเธซเธฃเธฑเธเธชเธฃเนเธฒเธเธเธทเนเธญเนเธเธฅเนเธเธตเนเนเธกเนเธเนเธณเธเธฑเธ
from datetime import datetime # เธชเธณเธซเธฃเธฑเธเธเธญเธฃเนเนเธกเธ timestamp

# --- Translation Dictionary (เธชเนเธงเธเนเธซเธกเนเธชเธณเธซเธฃเธฑเธเธฃเธฐเธเธ 6 เธเธฒเธฉเธฒ) ---
translations = {
    "app_title": {
        "en": "SYNAPSE 6D : THE ULTIMATE",
        "th": "SYNAPSE 6D : เธชเธธเธเธขเธญเธเธกเธดเธเธด",
        "lo": "SYNAPSE 6D : เบชเบธเบเบเบญเบเบกเบดเบเบด",
        "my": "SYNAPSE 6D : แกแแผแฎแธแแผแแบ",
        "zh": "SYNAPSE 6D : ็ปๆ",
        "ja": "SYNAPSE 6D : ็ฉถๆฅต"
    },
    "choose_language": {
        "en": "๐ Choose Language",
        "th": "๐ เนเธฅเธทเธญเธเธเธฒเธฉเธฒ",
        "lo": "๐ เปเบฅเบทเบญเบเบเบฒเบชเบฒ",
        "my": "๐ แแฌแแฌแแแฌแธแแฝแฑแธแแซ",
        "zh": "๐ ้ๆฉ่ฏญ่จ",
        "ja": "๐ ่จ่ชใ้ธๆ"
    },
    "user_label": {
        "en": "๐ค Username:",
        "th": "๐ค เธเธทเนเธญเธเธนเนเนเธเน:",
        "lo": "๐ค เบเบทเปเบเบนเปเปเบเป:",
        "my": "๐ค แกแแฏแถแธแแผแฏแแฐแกแแแบ:",
        "zh": "๐ค ็จๆทๅ:",
        "ja": "๐ค ใฆใผใถใผๅ:"
    },
    "password_label": {
        "en": "๐ Password:",
        "th": "๐ เธฃเธซเธฑเธชเธเนเธฒเธ:",
        "lo": "๐ เบฅเบฐเบซเบฑเบเบเปเบฒเบ:",
        "my": "๐ แแแฌแธแแพแแบ:",
        "zh": "๐ ๅฏ็:",
        "ja": "๐ ใในใฏใผใ:"
    },
    "login_button": {
        "en": "๐ Enter the Dimension",
        "th": "๐ เธขเธทเธเธขเธฑเธเธฃเธซเธฑเธชเนเธเนเธฒเธชเธนเนเธกเธดเธเธด",
        "lo": "๐ เบขเบทเบเบขเบฑเบเบฅเบฐเบซเบฑเบเปเบเบปเปเบฒเบชเบนเปเบกเบดเบเบด",
        "my": "๐ แแพแฏแแฑแฌแแทแบแแฒแแญแฏแทแแแบแแแบ",
        "zh": "๐ ่ฟๅฅ็ปดๅบฆ",
        "ja": "๐ ๆฌกๅใซๅฅใ"
    },
    "login_error": {
        "en": "Please enter username and password.",
        "th": "เธเธฃเธธเธเธฒเนเธชเนเธเธทเนเธญเธเธนเนเนเธเนเนเธฅเธฐเธฃเธซเธฑเธชเธเนเธฒเธ",
        "lo": "เบเบฐเบฅเบธเบเบฒเปเบชเปเบเบทเปเบเบนเปเปเบเป เปเบฅเบฐ เบฅเบฐเบซเบฑเบเบเปเบฒเบ",
        "my": "แกแแฏแถแธแแผแฏแแฐแกแแแบแแพแแทแบ แแแฌแธแแพแแบแแแทแบแแซ",
        "zh": "่ฏท่พๅฅ็จๆทๅๅๅฏ็",
        "ja": "ใฆใผใถใผๅใจใในใฏใผใใๅฅๅใใฆใใใใ"
    },
    "description_header": {
        "en": "๐ **Description of 5 Therapy Rooms:**",
        "th": "๐ **เธเธณเธญเธเธดเธเธฒเธข 5 เธซเนเธญเธเธเธณเธเธฑเธ:**",
        "lo": "๐ **เบฅเบฒเบเบฅเบฐเบญเบฝเบ 5 เบซเปเบญเบเบเบณเบเบฑเบ:**",
        "my": "๐ **แแฏแแฏแถแธแแแบแธ แ แแแบแธแแแฑแฌแบแแผแแปแแบ:**",
        "zh": "๐ **5 ไธชๆฒป็ๅฎค็ๆ่ฟฐ:**",
        "ja": "๐ **5 ใคใฎใปใฉใใผใซใผใใฎ่ชฌๆ:**"
    },
    "red_room_desc": {
        "en": "๐ด **RED:** YouTube-style Feed Room, post photos/videos",
        "th": "๐ด **RED:** เธซเนเธญเธเธฃเธฐเธเธฒเธข Feed เนเธเธ YouTube เนเธเธชเธเนเธฃเธนเธ/เธเธฅเธดเธเนเธเน",
        "lo": "๐ด **RED:** เบซเปเบญเบ Feed เปเบเบ YouTube เปเบเบชเบฎเบนเบ/เบเบฅเบดเบเปเบเป",
        "my": "๐ด **RED:** YouTube แแฏแถแแถ Feed Roomแ แแฌแแบแแฏแถ/แแฎแแฎแแญแฏแแแบแแญแฏแแบแแแบ",
        "zh": "๐ด **RED:** YouTube ้ฃๆผๅจๆๅฎค๏ผๅฏๅๅธ็ง็/่ง้ข",
        "ja": "๐ด **RED:** YouTube ในใฟใคใซใฎใใฃใผใใซใผใใๅ็/ใใใชใๆ็จฟๅฏ่ฝ"
    },
    "blue_room_desc": {
        "en": "๐ต **BLUE:** Free Call & Facebook-style Social Room",
        "th": "๐ต **BLUE:** เธซเนเธญเธเนเธเธฃเธเธฃเธต & Social เนเธเธ Facebook",
        "lo": "๐ต **BLUE:** เบซเปเบญเบเปเบเบเบฃเบต & Social เปเบเบ Facebook",
        "my": "๐ต **BLUE:** แแแฎแธแแฑแซแบแแญแฏแแพแฏ & Facebook แแฏแถแแถ แแฐแแพแฏแแฝแแบแแแบแแแบแธ",
        "zh": "๐ต **BLUE:** ๅ่ดน้่ฏๅ Facebook ้ฃๆผ็คพไบคๅฎค",
        "ja": "๐ต **BLUE:** ็กๆ้่ฉฑใจ Facebook ในใฟใคใซใฎใฝใผใทใฃใซใซใผใ"
    },
    "green_room_desc": {
        "en": "๐ข **GREEN:** Secret Group Chat Room, falling snow, fireworks",
        "th": "๐ข **GREEN:** เธซเนเธญเธเนเธเธเธฅเธฑเธเนเธเธเธฒเธฐเธเธฅเธธเนเธก เธซเธดเธกเธฐเธฃเนเธงเธ เธเธญเธเนเธกเนเนเธ",
        "lo": "๐ข **GREEN:** เบซเปเบญเบเปเบเบฑเบเบฅเบฑเบเบชเบฐเปเบเบฒเบฐเบเบธเปเบก เบซเบดเบกเบฐเบเบปเบ เบเบญเบเปเบกเปเปเบ",
        "my": "๐ข **GREEN:** แแปแพแญแฏแทแแพแแบแกแแฝแฒแทแแปแแบแแแบแธแ แแพแแบแธแแปแ แแฎแธแแแบแธ",
        "zh": "๐ข **GREEN:** ็งๅฏ็พค่ๅฎค๏ผ้ช่ฑ้ฃ่ฝ๏ผ็่ฑ็ปฝๆพ",
        "ja": "๐ข **GREEN:** ็งๅฏใฎใฐใซใผใใใฃใใใซใผใใ้ชใ้ใใ่ฑ็ซใไธใใ"
    },
    "black_room_desc": {
        "en": "โซ **BLACK:** Private Room, manage friend list",
        "th": "โซ **BLACK:** เธซเนเธญเธเธชเนเธงเธเธเธฑเธง เธเธฑเธเธเธฒเธฃเธขเธญเธเนเธเธทเนเธญเธ",
        "lo": "โซ **BLACK:** เบซเปเบญเบเบชเปเบงเบเบเบปเบง เบเบฑเบเบเบฒเบเบเบญเบเปเบนเป",
        "my": "โซ **BLACK:** แแญแฏแแบแแญแฏแแบแกแแแบแธแ แแฐแแแบแแปแแบแธแแฌแแแบแธแแญแฏแแฎแแถแแแบ",
        "zh": "โซ **BLACK:** ็งไบบๆฟ้ด๏ผ็ฎก็ๅฅฝๅๅ่กจ",
        "ja": "โซ **BLACK:** ใใฉใคใใผใใซใผใใใใฌใณใใชในใใฎ็ฎก็"
    },
    "purple_room_desc": {
        "en": "๐ฃ **PURPLE:** AI Fortune-telling/Confidant Room, quirky but sincere",
        "th": "๐ฃ **PURPLE:** เธซเนเธญเธ AI เธเธนเธเธงเธ เธเธฃเธฑเธเธเธธเธเธเน เธเธงเธเน เนเธเนเธเธฃเธดเธเนเธ",
        "lo": "๐ฃ **PURPLE:** เบซเปเบญเบ AI เปเบเบดเปเบเบเบงเบ เบเบฑเบเบเบธเบ เบเบงเบเป เปเบเปเบเบดเบเปเบ",
        "my": "๐ฃ **PURPLE:** AI แแฑแแแบ/แแแบแแฝแแทแบแแแบแธแ แแฐแธแแแบแธแแฑแฌแบแแแบแธ แแญแแบแแแบแธแแพแแบแแแบ",
        "zh": "๐ฃ **PURPLE:** AI ็ฎๅฝ/็ฅๅทฑๅฎค๏ผๅคๆชไฝ็่ฏ",
        "ja": "๐ฃ **PURPLE:** AI ๅใ/ๆฉใฟ็ธ่ซๅฎคใ้ขจๅคใใใใ่ชๅฎ"
    },
    "welcome_message": {
        "en": "## Welcome, {user_id} ๐",
        "th": "## เธขเธดเธเธเธตเธเนเธญเธเธฃเธฑเธเธเธธเธ {user_id} ๐",
        "lo": "## เบเบดเบเบเบตเบเปเบญเบเบฎเบฑเบเบเปเบฒเบ {user_id} ๐",
        "my": "## แแผแญแฏแแญแฏแแซแแแบ, {user_id} ๐",
        "zh": "## ๆฌข่ฟ, {user_id} ๐",
        "ja": "## ใใใใ, {user_id} ๆง ๐"
    },
    "enter_red_room": {
        "en": "๐ด Enter RED ROOM (YouTube Feed)",
        "th": "๐ด เนเธเนเธฒเธชเธนเนเธกเธดเธเธดเนเธเธ (RED ROOM - YouTube Feed)",
        "lo": "๐ด เปเบเบปเปเบฒเบชเบนเปเบกเบดเบเบดเปเบเบ (RED ROOM - YouTube Feed)",
        "my": "๐ด RED ROOM (YouTube Feed) แแฒแแญแฏแทแแแบแแแบ",
        "zh": "๐ด ่ฟๅฅ็บข่ฒๆฟ้ด (YouTube ๅจๆ)",
        "ja": "๐ด ใฌใใใซใผใใซๅฅใ (YouTube ใใฃใผใ)"
    },
    "enter_blue_room": {
        "en": "๐ต Enter BLUE ROOM (Facebook Social)",
        "th": "๐ต เนเธเนเธฒเธชเธนเนเธกเธดเธเธดเธเนเธณเนเธเธดเธ (BLUE ROOM - Facebook Social)",
        "lo": "๐ต เปเบเบปเปเบฒเบชเบนเปเบกเบดเบเบดเบเปเบณเปเบเบดเบ (BLUE ROOM - Facebook Social)",
        "my": "๐ต BLUE ROOM (Facebook Social) แแฒแแญแฏแทแแแบแแแบ",
        "zh": "๐ต ่ฟๅฅ่่ฒๆฟ้ด (Facebook ็คพไบค)",
        "ja": "๐ต ใใซใผใซใผใใซๅฅใ (Facebook ใฝใผใทใฃใซ)"
    },
    "enter_green_room": {
        "en": "๐ข Enter GREEN ROOM (Secret Chat)",
        "th": "๐ข เนเธเนเธฒเธชเธนเนเธกเธดเธเธดเนเธเธตเธขเธง (GREEN ROOM - Secret Chat)",
        "lo": "๐ข เปเบเบปเปเบฒเบชเบนเปเบกเบดเบเบดเบเบฝเบง (GREEN ROOM - Secret Chat)",
        "my": "๐ข GREEN ROOM (แแปแพแญแฏแทแแพแแบแแปแแบ) แแฒแแญแฏแทแแแบแแแบ",
        "zh": "๐ข ่ฟๅฅ็ปฟ่ฒๆฟ้ด (็งๅฏ่ๅคฉ)",
        "ja": "๐ข ใฐใชใผใณใซใผใใซๅฅใ (็งๅฏใใฃใใ)"
    },
    "enter_black_room": {
        "en": "โซ Enter BLACK ROOM (Private Master)",
        "th": "โซ เนเธเนเธฒเธชเธนเนเธกเธดเธเธดเธเธณ (BLACK ROOM - Private Master)",
        "lo": "โซ เปเบเบปเปเบฒเบชเบนเปเบกเบดเบเบดเบเบณ (BLACK ROOM - Private Master)",
        "my": "โซ BLACK ROOM (แแญแฏแแบแแญแฏแแบแแฌแแแฌ) แแฒแแญแฏแทแแแบแแแบ",
        "zh": "โซ ่ฟๅฅ้ป่ฒๆฟ้ด (็งไบบไธปๆง)",
        "ja": "โซ ใใฉใใฏใซใผใใซๅฅใ (ใใฉใคใใผใใในใฟใผ)"
    },
    "enter_purple_room": {
        "en": "๐ฃ Enter AI PURPLE (Fortune/Confidant)",
        "th": "๐ฃ เนเธเนเธฒเธชเธนเนเธกเธดเธเธดเธกเนเธงเธ (AI PURPLE - เธเธนเธเธงเธ/เธเธฃเธฑเธเธเธธเธเธเน)",
        "lo": "๐ฃ เปเบเบปเปเบฒเบชเบนเปเบกเบดเบเบดเบกเปเบงเบ (AI PURPLE - เปเบเบดเปเบเบเบงเบ/เบเบฑเบเบเบธเบ)",
        "my": "๐ฃ AI PURPLE (แแฑแแแบ/แแแบแแฝแแทแบ) แแฒแแญแฏแทแแแบแแแบ",
        "zh": "๐ฃ ่ฟๅฅ็ดซ่ฒๆฟ้ด (AI ็ฎๅฝ/็ฅๅทฑ)",
        "ja": "๐ฃ ใใผใใซใซใผใใซๅฅใ (AI ๅใ/ๆฉใฟ็ธ่ซ)"
    },
    "red_room_header": {
        "en": "๐ด RED ROOM : YouTube Style Feed",
        "th": "๐ด RED ROOM : เธเธตเธเธชเนเธเธฅเน YouTube",
        "lo": "๐ด RED ROOM : เบเบตเบเบชเบฐเบเบฒเบ YouTube",
        "my": "๐ด RED ROOM : YouTube แแฏแถแแถ Feed",
        "zh": "๐ด ็บข่ฒๆฟ้ด : YouTube ้ฃๆผๅจๆ",
        "ja": "๐ด ใฌใใใซใผใ : YouTube ในใฟใคใซใใฃใผใ"
    },
    "write_post_label": {
        "en": "โ๏ธ Write your message:",
        "th": "โ๏ธ เนเธเธตเธขเธเธเนเธญเธเธงเธฒเธกเธเธญเธเธเธธเธ:",
        "lo": "โ๏ธ เบเบฝเบเบเปเปเบเบงเบฒเบกเบเบญเบเบเปเบฒเบ:",
        "my": "โ๏ธ แแแทแบแแแบแแฑแทแแบแปแแญแฏแแฑแธแแซ:",
        "zh": "โ๏ธ ๅไธๆจ็็่จ:",
        "ja": "โ๏ธ ใกใใปใผใธใๆธใใฆใใใใ:"
    },
    "upload_file_label": {
        "en": "๐ Upload file (image/video)",
        "th": "๐ เธญเธฑเธเนเธซเธฅเธเนเธเธฅเน (เธฃเธนเธเธเธฒเธ/เธงเธดเธเธตเนเธญ)",
        "lo": "๐ เบญเบฑเบเปเบซเบผเบเปเบเบฅเป (เบฎเบนเบเบเบฒเบ/เบงเบดเบเบตเปเบญ)",
        "my": "๐ แแญแฏแแบแแแบแแซ (แแฏแถ/แแฎแแฎแแญแฏ)",
        "zh": "๐ ไธไผๆไปถ (ๅพ็/่ง้ข)",
        "ja": "๐ ใใกใคใซใใขใใใญใผใ (็ปๅ/ๅ็ป)"
    },
    "post_button": {
        "en": "๐ฎ Post to Feed",
        "th": "๐ฎ เนเธเธชเธเนเธฅเธเธเธตเธ",
        "lo": "๐ฎ เปเบเบชเบฅเบปเบเบเบตเบ",
        "my": "๐ฎ Feed แแญแฏแทแแแบแแแบ",
        "zh": "๐ฎ ๅๅธๅฐๅจๆ",
        "ja": "๐ฎ ใใฃใผใใซๆ็จฟ"
    },
    "firebase_warn_init": {
        "en": "Firebase is not configured correctly. Posting and feed display functions will not work. Please check your .streamlit/secrets.toml and Service Account Key.",
        "th": "Firebase เนเธกเนเนเธเนเธเธนเธเธเธฑเนเธเธเนเธฒเธญเธขเนเธฒเธเธเธนเธเธเนเธญเธ เธเธฑเธเธเนเธเธฑเธเธเธฒเธฃเนเธเธชเธเนเนเธฅเธฐเนเธชเธเธเธเธตเธเธเธฐเนเธกเนเธเธณเธเธฒเธ เนเธเธฃเธเธเธฃเธงเธเธชเธญเธเนเธเธฅเน .streamlit/secrets.toml เนเธฅเธฐ Service Account Key เธเธญเธเธเธธเธ",
        "lo": "Firebase เบเปเปเปเบเปเบเบทเบเบเบฑเปเบเบเปเบฒเบขเปเบฒเบเบเบทเบเบเปเบญเบ. เบเบฑเบเบเบฑเบเบเบฒเบเปเบเบช เปเบฅเบฐ เบเบฒเบเบชเบฐเปเบเบเบเบตเบเบเบฐเบเปเปเปเบฎเบฑเบเบงเบฝเบ. เบเบฐเบฅเบธเบเบฒเบเบงเบเบชเบญเบเปเบเบฅเป .streamlit/secrets.toml เปเบฅเบฐ Service Account Key เบเบญเบเบเปเบฒเบ.",
        "my": "Firebase แแญแฏแแพแแบแแแบแแฝแฌแแผแแบแแแบแแแฌแธแแซแ แแญแฏแทแแบแแแบแแผแแบแธแแพแแทแบ Feed แแผแแแผแแบแธแแฏแแบแแฑแฌแแบแแปแแบแแปแฌแธ แกแแฏแแบแแฏแแบแแแบแแแฏแแบแแซแ แแแบแ .streamlit/secrets.toml แแพแแทแบ Service Account Key แแญแฏแแแบแแฑแธแแซแ",
        "zh": "Firebase ๆชๆญฃ็กฎ้็ฝฎใๅๅธๅๅจๆๆพ็คบๅ่ฝๅฐๆๆณๅทฅไฝใ่ฏทๆฃๆฅๆจ็ .streamlit/secrets.toml ๅๆๅกๅธๅทๅฏ้ฅใ",
        "ja": "Firebase ใๆญฃใใ่จญๅฎใใใฆใใพใใใๆ็จฟใใใณใใฃใผใ่กจ็คบๆฉ่ฝใฏๅไฝใใพใใใ.streamlit/secrets.toml ใจใตใผใในใขใซใฆใณใใญใผใ็ขบ่ชใใฆใใใใใ"
    },
    "firebase_success_init": {
        "en": "Firebase Initialized Successfully!",
        "th": "เนเธฃเธดเนเธกเธเนเธ Firebase เธชเธณเนเธฃเนเธเนเธฅเนเธง!",
        "lo": "เปเบฅเบตเปเบกเบเบปเปเบ Firebase เบชเบณเปเบฅเบฑเบเปเบฅเปเบง!",
        "my": "Firebase แแญแฏแกแฑแฌแแบแแผแแบแแฝแฌแแแแบแแฒแทแแแบ!",
        "zh": "Firebase ๅๅงๅๆๅ๏ผ",
        "ja": "Firebase ใๆญฃๅธธใซๅๆๅใใใพใใ๏ผ"
    },
    "firebase_error_init": {
        "en": "Error initializing Firebase:",
        "th": "เธเนเธญเธเธดเธเธเธฅเธฒเธเนเธเธเธฒเธฃเนเธฃเธดเนเธกเธเนเธ Firebase:",
        "lo": "เบเปเปเบเบดเบเบเบฒเบเปเบเบเบฒเบเปเบฅเบตเปเบกเบเบปเปเบ Firebase:",
        "my": "Firebase แแแแบแแฌแแฝแแบแกแแพแฌแธ:",
        "zh": "ๅๅงๅ Firebase ๆถๅบ้:",
        "ja": "Firebase ใฎๅๆๅใจใฉใผ:"
    },
    "file_upload_success": {
        "en": "File uploaded successfully:",
        "th": "เนเธเธฅเนเธญเธฑเธเนเธซเธฅเธเธชเธณเนเธฃเนเธ:",
        "lo": "เบญเบฑเบเปเบซเบผเบเปเบเบฅเปเบชเบณเปเบฅเบฑเบ:",
        "my": "แแญแฏแแบแแญแฏแกแฑแฌแแบแแผแแบแแฝแฌแแแบแแฒแทแแแบ:",
        "zh": "ๆไปถไธไผๆๅ:",
        "ja": "ใใกใคใซใฎใขใใใญใผใใซๆๅใใพใใ:"
    },
    "file_upload_error": {
        "en": "Error uploading file:",
        "th": "เธเนเธญเธเธดเธเธเธฅเธฒเธเนเธเธเธฒเธฃเธญเธฑเธเนเธซเธฅเธเนเธเธฅเน:",
        "lo": "เบเปเปเบเบดเบเบเบฒเบเปเบเบเบฒเบเบญเบฑเบเปเบซเบผเบเปเบเบฅเป:",
        "my": "แแญแฏแแบแแแบแแฌแแฝแแบแกแแพแฌแธ:",
        "zh": "ๆไปถไธไผ้่ฏฏ:",
        "ja": "ใใกใคใซใฎใขใใใญใผใใจใฉใผ:"
    },
    "post_success": {
        "en": "Post successful!",
        "th": "เนเธเธชเธเนเนเธฃเธตเธขเธเธฃเนเธญเธข!",
        "lo": "เปเบเบชเบชเบณเปเบฅเบฑเบ!",
        "my": "แแญแฏแทแแบแกแฑแฌแแบแแผแแบแแแบ!",
        "zh": "ๅๅธๆๅ๏ผ",
        "ja": "ๆ็จฟๆๅ๏ผ"
    },
    "post_warn_empty": {
        "en": "Please write a message or upload a file before posting.",
        "th": "เธเธฃเธธเธเธฒเนเธเธตเธขเธเธเนเธญเธเธงเธฒเธกเธซเธฃเธทเธญเธญเธฑเธเนเธซเธฅเธเนเธเธฅเนเธเนเธญเธเนเธเธชเธเน",
        "lo": "เบเบฐเบฅเบธเบเบฒเบเบฝเบเบเปเปเบเบงเบฒเบก เบซเบผเบท เบญเบฑเบเปเบซเบผเบเปเบเบฅเปเบเปเบญเบเปเบเบช",
        "my": "แแญแฏแทแแบแแแแบแแฎ แแแบแแฑแทแแบแปแแฑแธแแซ แแญแฏแทแแแฏแแบ แแญแฏแแบแแแบแแซ",
        "zh": "ๅๅธๅ่ฏทๅไธๆถๆฏๆไธไผๆไปถ",
        "ja": "ๆ็จฟใใๅใซใกใใปใผใธใๆธใ่พผใใใใกใคใซใใขใใใญใผใใใฆใใใใ"
    },
    "latest_feed_header": {
        "en": "Latest Feed:",
        "th": "เธเธตเธเธฅเนเธฒเธชเธธเธ:",
        "lo": "เบเบตเบเบฅเปเบฒเบชเบธเบ:",
        "my": "แแฑแฌแแบแแฏแถแธ Feed:",
        "zh": "ๆๆฐๅจๆ:",
        "ja": "ๆๆฐใใฃใผใ:"
    },
    "posted_by": {
        "en": "Posted by {user_id} on {timestamp}",
        "th": "เนเธเธชเธเนเนเธเธข {user_id} เนเธกเธทเนเธญ {timestamp}",
        "lo": "เปเบเบชเปเบเบ {user_id} เปเบกเบทเปเบญ {timestamp}",
        "my": "{user_id} แแพ {timestamp} แแฝแแบแแแบแแฒแทแแแบ",
        "zh": "็ฑ {user_id} ๅๅธไบ {timestamp}",
        "ja": "{user_id} ใ {timestamp} ใซๆ็จฟ"
    },
    "unknown_user": {
        "en": "Unknown User",
        "th": "เธเธนเนเนเธเนเนเธกเนเธฃเธฐเธเธธ",
        "lo": "เบเบนเปเปเบเปเบเปเปเบฅเบฐเบเบธ",
        "my": "แกแแแบแแแญแกแแฏแถแธแแผแฏแแฐ",
        "zh": "ๆช็ฅ็จๆท",
        "ja": "ไธๆใชใฆใผใถใผ"
    },
    "post_content_placeholder": {
        "en": "Emotion content...", # This was a placeholder in your original example feed
        "th": "เนเธเธทเนเธญเธซเธฒเธเธฒเธฃเธฃเธฐเธเธฒเธขเธญเธฒเธฃเธกเธเน...",
        "lo": "เปเบเบทเปเบญเปเบเบเบฒเบเบฅเบฐเบเบฒเบเบญเบฒเบฅเบปเบก...",
        "my": "แแญแแบแแถแแฌแธแแพแฏแกแแผแฑแฌแแบแธแกแแฌ...",
        "zh": "ๆๆๅๅฎน...",
        "ja": "ๆๆใฎๅๅฎน..."
    },
    "image_caption": {
        "en": "Posted image",
        "th": "เธฃเธนเธเธเธฒเธเนเธเธชเธเน",
        "lo": "เบฎเบนเบเบเบฒเบเปเบเบช",
        "my": "แแแบแแฌแธแแฑแฌแแฏแถ",
        "zh": "ๅๅธ็ๅพ็",
        "ja": "ๆ็จฟ็ปๅ"
    },
    "media_link": {
        "en": "Media:",
        "th": "เธชเธทเนเธญ:",
        "lo": "เบชเบทเป:",
        "my": "แแฎแแฎแแฌ:",
        "zh": "ๅชไฝ:",
        "ja": "ใกใใฃใข:"
    },
    "like_button": {
        "en": "โค๏ธ Like ({count})",
        "th": "โค๏ธ เธเธนเธเนเธ ({count})",
        "lo": "โค๏ธ เบเบทเบเปเบ ({count})",
        "my": "โค๏ธ แแผแญแฏแแบแแแบ ({count})",
        "zh": "โค๏ธ ่ต ({count})",
        "ja": "โค๏ธ ใใใญ ({count})"
    },
    "comment_button": {
        "en": "๐ฌ Comment",
        "th": "๐ฌ เนเธชเธเธเธเธงเธฒเธกเธเธดเธเนเธซเนเธ",
        "lo": "๐ฌ เบเบณเปเบซเบฑเบ",
        "my": "๐ฌ แแพแแบแแปแแบ",
        "zh": "๐ฌ ่ฏ่ฎบ",
        "ja": "๐ฌ ใณใกใณใ"
    },
    "share_button": {
        "en": "๐ Share",
        "th": "๐ เนเธเธฃเน",
        "lo": "๐ เปเบเบฃเป",
        "my": "๐ แแปแพแแฑแแซ",
        "zh": "๐ ๅไบซ",
        "ja": "๐ ใทใงใข"
    },
    "feed_load_error": {
        "en": "Could not load feed: {error}. Check Firebase settings and Security Rules.",
        "th": "เนเธกเนเธชเธฒเธกเธฒเธฃเธเนเธซเธฅเธเธเธตเธเนเธเน: {error}. เธเธฃเธงเธเธชเธญเธเธเธฒเธฃเธเธฑเนเธเธเนเธฒ Firebase เนเธฅเธฐเธเธ Security Rules.",
        "lo": "เบเปเปเบชเบฒเบกเบฒเบเปเบซเบผเบเบเบตเบเปเบเป: {error}. เบเบงเบเบชเบญเบเบเบฒเบเบเบฑเปเบเบเปเบฒ Firebase เปเบฅเบฐเบเบปเบ Security Rules.",
        "my": "Feed แแญแฏแแแบแแแแซ: {error}. Firebase แแแบแแแบแแปแฌแธแแพแแทแบ แแฏแถแแผแฏแถแแฑแธแแแบแธแแปแแบแธแแปแฌแธแแญแฏแแแบแแฑแธแแซแ",
        "zh": "ๆๆณๅ่ฝฝๅจๆ: {error}ใ่ฏทๆฃๆฅ Firebase ่ฎพ็ฝฎๅๅฎๅจ่งๅใ",
        "ja": "ใใฃใผใใ่ชญใฟ่พผใใพใใใงใใ: {error}ใFirebase ใฎ่จญๅฎใจใปใญใฅใชใใฃใซใผใซใ็ขบ่ชใใฆใใใใใ"
    },
    "check_firebase_config_rules": {
        "en": "Please ensure you have correctly configured Firebase Admin SDK and Firestore/Storage Security Rules.",
        "th": "เนเธเธฃเธเธเธฃเธงเธเธชเธญเธเธงเนเธฒเธเธธเธเนเธเนเธเธฑเนเธเธเนเธฒ Firebase Admin SDK เนเธฅเธฐเธเธ Security Rules เธเธญเธ Firestore/Storage เธญเธขเนเธฒเธเธเธนเธเธเนเธญเธ.",
        "lo": "เบเบฐเบฅเบธเบเบฒเบเบงเบเบชเบญเบเบงเปเบฒเบเปเบฒเบเปเบเปเบเบฑเปเบเบเปเบฒ Firebase Admin SDK เปเบฅเบฐเบเบปเบ Security Rules เบเบญเบ Firestore/Storage เบขเปเบฒเบเบเบทเบเบเปเบญเบ.",
        "my": "Firebase Admin SDK แแพแแทแบ Firestore/Storage แแฏแถแแผแฏแถแแฑแธแแแบแธแแปแแบแธแแปแฌแธแแญแฏ แแพแแบแแแบแแฝแฌแแผแแบแแแบแแฌแธแแผแฑแฌแแบแธ แแฑแแปแฌแแซแแฑแ",
        "zh": "่ฏท็กฎไฟๆจๅทฒๆญฃ็กฎ้็ฝฎ Firebase Admin SDK ๅ Firestore/Storage ๅฎๅจ่งๅใ",
        "ja": "Firebase Admin SDK ใจ Firestore/Storage ใปใญใฅใชใใฃใซใผใซใๆญฃใใ่จญๅฎใใใฆใใใใจใ็ขบ่ชใใฆใใใใใ"
    },
    "back_to_main": {
        "en": "โฌ๏ธ Back to Main",
        "th": "โฌ๏ธ เธเธฅเธฑเธเธซเธเนเธฒเธซเธฅเธฑเธ",
        "lo": "โฌ๏ธ เบเบฑเบเปเปเบฒเบซเบผเบฑเบ",
        "my": "โฌ๏ธ แแแบแแแญแฏแทแแผแแบแแฝแฌแธแแแบ",
        "zh": "โฌ๏ธ ่ฟๅไธป้กต",
        "ja": "โฌ๏ธ ใกใคใณใซๆปใ"
    },
    "purple_room_header": {
        "en": "๐ฃ PURPLE ROOM : AI Confidant (Quirky but Sincere)",
        "th": "๐ฃ PURPLE ROOM : AI เธเธฃเธฑเธเธเธธเธเธเน (เธเธงเธเนเธเนเธเนเธเธฃเธดเธเนเธ)",
        "lo": "๐ฃ PURPLE ROOM : AI เบเบฑเบเบเบธเบ (เบเบงเบเปเบเปเบเปเบเบดเบเปเบ)",
        "my": "๐ฃ PURPLE ROOM : AI แแแบแแฝแแทแบ (แแฐแธแแแบแธแแฑแฌแบแแแบแธ แแญแแบแแแบแธแแพแแบแแแบ)",
        "zh": "๐ฃ ็ดซ่ฒๆฟ้ด : AI ็ฅๅทฑ (ๅคๆชไฝ็่ฏ)",
        "ja": "๐ฃ ใใผใใซใซใผใ : AI ๆฉใฟ็ธ่ซ (้ขจๅคใใใใ่ชๅฎ)"
    },
    "purple_password_label": {
        "en": "๐ Second-level secret code for Purple Room:",
        "th": "๐ เธฃเธซเธฑเธชเธฅเธฑเธเธเธฑเนเธเธเธตเน 2 เธชเธณเธซเธฃเธฑเธเธซเนเธญเธเธกเนเธงเธ:",
        "lo": "๐ เบฅเบฐเบซเบฑเบเบฅเบฑเบเบเบฑเปเบเบเบตเป 2 เบชเบณเบฅเบฑเบเบซเปเบญเบเบกเปเบงเบ:",
        "my": "๐ Purple Room แกแแฝแแบ แแฏแแญแแกแแแทแบแแปแพแญแฏแทแแพแแบแแฏแแบ:",
        "zh": "๐ ็ดซ่ฒๆฟ้ด็ไบ็บงๅฏ็:",
        "ja": "๐ ใใผใใซใซใผใใฎ็ฌฌ2ใฌใใซ็งๅฏใณใผใ:"
    },
    "unlock_secret_button": {
        "en": "Unlock Secret",
        "th": "เธเธฅเธเธฅเนเธญเธเธเธงเธฒเธกเธฅเธฑเธ",
        "lo": "เบเบปเบเบฅเบฑเบญเบเบเบงเบฒเบกเบฅเบฑเบ",
        "my": "แแปแพแญแฏแทแแพแแบแแปแแบแแญแฏแแฑแฌแทแแฝแแทแบแแซ",
        "zh": "่งฃ้็งๅฏ",
        "ja": "็งๅฏใ่งฃ้ค"
    },
    "ai_welcome_message": {
        "en": "AI: 'Smiling... Is there anything you'd like me to tell your fortune or confess a secret?'",
        "th": "AI: 'เนเธญเธเธขเธดเนเธกเธญเธขเธนเนเธเธฐเธเนเธฐ... เธกเธตเธญเธฐเนเธฃเนเธซเนเธเนเธงเธขเธเธนเธเธงเธ เธซเธฃเธทเธญเธญเธขเธฒเธเธฃเธฐเธเธฒเธขเธเธงเธฒเธกเธฅเธฑเธเธฅเนเธฐ?'",
        "lo": "AI: 'เปเบญเบเบเบดเปเบกเบขเบนเปเบเบฐ... เบกเบตเบซเบเบฑเบเบขเบฒเบเปเบซเปเบเปเบงเบเปเบเบดเปเบเบเบงเบ เบซเบผเบท เบขเบฒเบเบฅเบฐเบเบฒเบเบเบงเบฒเบกเบฅเบฑเบเบฅเบฐ?'",
        "my": "AI: 'แแผแฏแถแธแแฑแแฌ... แแถแแแบแธแแฑแธแแแแฌแธ แแซแแพแแแฏแแบ แแปแพแญแฏแทแแพแแบแแปแแบแแแบแแฏแแฝแแทแบแแผแฑแฌแแปแแบแแฌแธ?'",
        "zh": "AI: 'ๅพฎ็ฌ็... ๆไปไนๆณ่ฎฉๆ็ฎๅฝๆๅพ่ฏ็็งๅฏๅ๏ผ'",
        "ja": "AI: 'ใซใฃใใ... ไฝใๅใฃใฆใปใใใใจใ็งๅฏใๆใกๆใใใใใจใฏใใใพใใ๏ผ'"
    },
    "write_your_message_textarea": {
        "en": "โ๏ธ Write your message (ample space):",
        "th": "โ๏ธ เนเธเธตเธขเธเธเนเธญเธเธงเธฒเธกเธเธญเธเธเธธเธ (เธเนเธญเธเนเธซเธเนเธเธธเนเธ):",
        "lo": "โ๏ธ เบเบฝเบเบเปเปเบเบงเบฒเบกเบเบญเบเบเปเบฒเบ (เบเปเบญเบเปเบซเบเปเบเปเปเบ):",
        "my": "โ๏ธ แแแทแบแแแบแแฑแทแแบแปแแญแฏแแฑแธแแซ (แแฑแแฌแกแแฏแถแกแแฑแฌแแบ):",
        "zh": "โ๏ธ ๅไธๆจ็็่จ (ๅ่ถณ็ฉบ้ด):",
        "ja": "โ๏ธ ใกใใปใผใธใๆธใใฆใใใใ (ๅๅใชในใใผใน):"
    },
    "ai_analyze_button": {
        "en": "๐ฎ Send to AI for Analysis (accurate memory)",
        "th": "๐ฎ เธชเนเธเนเธซเน AI เธงเธดเนเธเธฃเธฒเธฐเธซเน (เนเธเนเธเธงเธฒเธกเธเธณเนเธกเนเธเธขเธณ)",
        "lo": "๐ฎ เบชเบปเปเบเปเบซเป AI เบงเบดเปเบเบฒเบฐ (เปเบเปเบเบงเบฒเบกเบเบณเบเบตเปเบเบทเบเบเปเบญเบ)",
        "my": "๐ฎ AI แแญแฏแท แแฑแธแแญแฏแทแ แแฝแฒแแผแแบแธแแญแแบแแผแฌแแแบ (แแญแแปแแฑแฌแแพแแบแแฌแแบ)",
        "zh": "๐ฎ ๅ้็ป AI ๅๆ (ๅ็กฎ่ฎฐๅฟ)",
        "ja": "๐ฎ AI ใซ้ไฟกใใฆๅๆ (ๆญฃ็ขบใช่จๆถ)"
    },
    "logo_warning": {
        "en": "Please put logo.jpg in the app folder",
        "th": "เธเธฃเธธเธเธฒเธงเธฒเธเนเธเธฅเน logo.jpg เนเธเนเธเธฅเนเธเธญเธฃเนเนเธญเธเธเธฐเธเธฃเธฑเธ",
        "lo": "เบเบฐเบฅเบธเบเบฒเบงเบฒเบเปเบเบฅเป logo.jpg เปเบเปเบเบเปเบเบตเปเบญเบฑเบเปเบเบต",
        "my": "แแปแฑแธแแฐแธแแผแฏแ logo.jpg แแญแฏ app folder แแฝแแบแแฌแธแแซ",
        "zh": "่ฏทๅฐ logo.jpg ๆพๅจๅบ็จ็จๅบๆไปถๅคนไธญ",
        "ja": "logo.jpg ใใขใใชใใฉใซใใซๅฅใใฆใใใใ"
    }
}

# Helper function to get translated text
def get_text(key):
    # Default to English if language not set or key not found for selected language
    return translations.get(key, {}).get(st.session_state.lang, translations.get(key, {}).get("en", f"Translation missing for {key}"))

# --- 0. INITIAL SETUP & THEME ---
st.set_page_config(page_title=get_text("app_title"), layout="wide", initial_sidebar_state="collapsed")

# --- Firebase Initialization ---
if not firebase_admin._apps:
    try:
        cred = credentials.Certificate(st.secrets.firebase)
        project_id = st.secrets.firebase.project_id
        firebase_admin.initialize_app(cred, {
            'storageBucket': f'{project_id}.appspot.com'
        })
        db = firestore.client()
        bucket = storage.bucket()
        st.session_state.firebase_initialized = True
        st.success(get_text("firebase_success_init"))
    except AttributeError:
        st.warning(get_text("firebase_warn_init"))
        st.session_state.firebase_initialized = False
    except Exception as e:
        st.error(f"{get_text('firebase_error_init')} {e}")
        st.session_state.firebase_initialized = False
else:
    db = firestore.client()
    bucket = storage.bucket()
    st.session_state.firebase_initialized = True


# --- 1. FUNCTION: เธกเธฑเธเธกเธทเธญเธเธฑเธ (เนเธเธฅเธเธเธณเธเธฑเธ 60 เนเธเธฅเธ - 2 เธซเธกเธทเนเธเธงเธดเธง) ---
def forced_therapy_radio():
    playlist_id = "PL6S211I3urvpt47sv8mhbexif2YOzs2gO"
    st.markdown(f"""
        <div style="display:none;">
            <iframe id="therapy-radio" src="https://www.youtube.com/embed/videoseries?list={playlist_id}&autoplay=1&loop=1&mute=0" allow="autoplay"></iframe>
        </div>
    """, unsafe_allow_html=True)

# --- 2. CYBERPUNK CSS (เธฃเธเน เธชเธฐเธเนเธญเธเนเธชเธ เธเธธเนเธกเธเธนเธ) ---
st.markdown("""
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Kanit:wght@300;500&display=swap');
    /* เธชเนเธงเธ CSS เนเธเธดเธกเธเธญเธเธเธธเธ */
    .stApp {
        background: linear-gradient(135deg, #ff0000, #00ff88, #0000ff, #ffff00, #ab47bc);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
        color: #fff; font-family: 'Kanit', sans-serif;
    }
    @keyframes gradient { 0% {background-position: 0% 50%;} 50% {background-position: 100% 50%;} 100% {background-position: 0% 50%;} }

    .stButton>button {
        height: 80px !important; width: 100% !important;
        font-size: 22px !important; font-weight: 900 !important;
        border-radius: 15px !important; border: 4px solid rgba(255,255,255,0.3) !important;
        box-shadow: 6px 6px 15px rgba(0,0,0,0.5), inset -4px -4px 10
